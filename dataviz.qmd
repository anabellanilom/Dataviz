---
title: "G√©nero y gabinetes"
format: html
editor: visual
---

## Exploraci√≥n de datos sobre representaci√≥n de g√©nero en los gabinetes

-   Nuffield Politics Research Centre. (s. f.). WhoGov dataset. Nuffield College, University of Oxford. Recuperado el 3 de enero de 2026, de <https://politicscentre.nuffield.ox.ac.uk/whogov-dataset/>

## Datos sobre representaci√≥n de las mujeres en los gabinetes del mundo entre 1966 y 2023

```{r}
#| echo: false
#| warning: false
#| include: false

library (tidyverse)
library(readr)
library (dplyr)
library(tidyr)
library(stringr)
library(gt)
library(ggplot2)
library(paletteer)
library(ellmer)
library(showtext)
library(sysfonts)
library(ggtext)
## Leer base whogov

WhoGovData <- read_csv("Data/WhoGov_crosssectional_V3.1.csv")

#Cantidad de pa√≠ses en la base (datos sobre mi unidad de an√°lisis)

Cantidaddepaises <- WhoGovData %>%
  count(country_name, sort = TRUE) %>%
  mutate(n)
Cantidaddepaises

#Selecci√≥n s√≥lo de Am√©rica Latina 

codigos <- c("ARG","BOL","BRA","CHL","COL","CRI","DOM","ECU","SLV","GTM","HND","MEX","NIC","PAN","PRY","PER","URY","VEN")

WhoGovData <- WhoGovData %>%
  mutate(country_isocode = str_to_upper(str_trim(country_isocode)))

AmericaLatina <- WhoGovData %>%
  filter(country_isocode %in% codigos)

# ¬øCu√°ntos pa√≠ses quedaron?
AmericaLatina %>% count(country_isocode, sort = TRUE)

# Diagn√≥stico: ¬øalg√∫n c√≥digo pedido no aparece en la base?
setdiff(codigos, unique(WhoGovData$country_isocode))

```

```{r}
#| echo: true
#| warning: false
#| include: false

#Proporci√≥n de mujeres
Prop_mujeres <- AmericaLatina %>%
  mutate(
    year = as.integer(year),
    year_country = paste(year, country_name)  # o unite("year_country", year, country_name, sep = " ", remove = FALSE)
  ) %>%
  group_by(year_country, year, country_name) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_),
    porcentaje = 100 * proporcion
  )%>%
  arrange(country_name)

resumen_mujeres <- AmericaLatina %>%
  summarise(
    media_fem      = mean(n_female_total, na.rm = TRUE),
    mediana_fem    = median(n_female_total, na.rm = TRUE),
    desvio_std_fem = sd(n_female_total, na.rm = TRUE),
    min_fem        = min(n_female_total, na.rm = TRUE),
    max_fem        = max(n_female_total, na.rm = TRUE),
    rango_fem      = diff(range(n_female_total, na.rm = TRUE)), # max - min robusto
    iqr_fem        = IQR(n_female_total, na.rm = TRUE),
    cantidad_obs   = n()
  )

base_pa <- AmericaLatina %>%
  mutate(year = as.integer(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_))

```

```{r}
#| title: Estad√≠sticas descriptivas de ministras en el per√≠odo 1966 a 2023
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboraci√≥n propia con datos de whogov - dataset"
#| include: true
#| fig-width: 14
#| fig-height: 8
#| fig-dpi: 300

resumen_global <- base_pa %>%
summarise(
ministras_total = sum(n_female_total, na.rm = TRUE),
cargos_totales  = sum(n_total, na.rm = TRUE),
prop_ministras  = if_else(cargos_totales > 0, ministras_total / cargos_totales, NA_real_),
prom_pa         = mean(proporcion, na.rm = TRUE),  
mediana_pa      = median(proporcion, na.rm = TRUE),
iqr_pa          = IQR(proporcion, na.rm = TRUE),
n_pais_anio     = n()
)

resumen_global %>%
  gt() %>%
  # Etiquetas
  cols_label(
    ministras_total = "Total ministras",
    cargos_totales  = "Cargos totales",
    prop_ministras  = "Proporci√≥n global",
    prom_pa         = "Promedio pa√≠s-a√±o",
    mediana_pa      = "Mediana pa√≠s-a√±o",
    iqr_pa          = "IQR pa√≠s-a√±o",
    n_pais_anio     = "N (pa√≠s-a√±o)"
  ) %>%
  # Agrupar columnas (se ve MUCHO m√°s prolijo)
  tab_spanner(
    label = "Conteos",
    columns = c(ministras_total, cargos_totales, n_pais_anio)
  ) %>%
  tab_spanner(
    label = "Distribuci√≥n (pa√≠s-a√±o)",
    columns = c(prom_pa, mediana_pa, iqr_pa)
  ) %>%
  tab_spanner(
    label = "Indicador clave",
    columns = c(prop_ministras)
  ) %>%
  # Formatos num√©ricos
  fmt_integer(columns = c(ministras_total, cargos_totales, n_pais_anio)) %>%
  fmt_number(columns = c(ministras_total, cargos_totales, n_pais_anio), sep_mark = ".", dec_mark = ",") %>%
  fmt_percent(columns = c(prop_ministras, prom_pa, mediana_pa, iqr_pa), decimals = 1) %>%
  # Alineaci√≥n + ancho (tabla ‚Äúrespira‚Äù)
  cols_align(align = "center", columns = everything()) %>%
  cols_width(
    everything() ~ px(150),
    prop_ministras ~ px(170)
  ) %>%
  # Header + fuente (m√°s editorial)
  tab_header(
    title = md("**Estad√≠sticas descriptivas de ministras (1966‚Äì2023)**"),
    subtitle = md("Regi√≥n completa ‚Äî resumen global del per√≠odo")
  ) %>%
  # Estilo general: limpio y consistente
  opt_table_outline() %>%
  opt_row_striping() %>%
  tab_options(
    table.font.names = c("Source Sans 3", "Source Sans Pro", "Arial"),
    table.font.size = px(14),
    heading.title.font.size = px(18),
    heading.subtitle.font.size = px(13),
    table.border.top.style = "solid",
    table.border.top.width = px(2),
    table.border.top.color = "gray80",
    table.border.bottom.style = "solid",
    table.border.bottom.width = px(2),
    table.border.bottom.color = "gray80",
    data_row.padding = px(10),
    column_labels.padding = px(10)
  ) %>%
  # Resaltar el indicador clave
  tab_style(
    style = list(
      cell_fill(color = "#F3F6FF"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(columns = prop_ministras)
  ) %>%
  # Fuente como nota (mejor que fig-cap para tablas)
  tab_source_note(
    source_note = md("**Fuente:** Elaboraci√≥n propia con datos de *WhoGov*.")
  )

```

```{r}
#| echo: false
#| warning: false
#| include: false

# 1) Resumen por a√±o
resumen_anual <- base_pa %>%
  group_by(year) %>%
  summarise(
    ministras_total = sum(n_female_total, na.rm = TRUE),
    cargos_totales  = sum(n_total, na.rm = TRUE),
    prop_ministras  = if_else(cargos_totales > 0, ministras_total / cargos_totales, NA_real_),
    prom_pa         = mean(proporcion, na.rm = TRUE),   # promedio de proporci√≥n pa√≠s-a√±o
    mediana_pa      = median(proporcion, na.rm = TRUE), # mediana de proporci√≥n pa√≠s-a√±o
    iqr_pa          = IQR(proporcion, na.rm = TRUE),    # rango intercuart√≠lico
    n_pais_anio     = n()
  ) %>%
  arrange(year)

# 2) Tabla con gt
resumen_anual %>%
  gt() %>%
  cols_label(
    year            = "A√±o",
    ministras_total = "Total ministras",
    cargos_totales  = "Cargos totales (a√±o)",
    prop_ministras  = "Proporci√≥n regional",
    prom_pa         = "Promedio pa√≠s-a√±o",
    mediana_pa      = "Mediana pa√≠s-a√±o",
    iqr_pa          = "IQR pa√≠s-a√±o",
    n_pais_anio     = "N pa√≠s-a√±o"
  ) %>%
  fmt_number(columns = c(ministras_total, cargos_totales, n_pais_anio), decimals = 0) %>%
  fmt_percent(columns = c(prop_ministras, prom_pa, mediana_pa, iqr_pa), decimals = 1) %>%
  tab_header(
    title = md("**Resumen global de representaci√≥n de ministras en el per√≠odo 1966 a 2023 por a√±o**"),
    subtitle = "Regi√≥n completa (1966‚Äì2023)"
  )
```

## Datos sobre Am√©rica Latina

```{r}
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboraci√≥n propia con datos de whogov-dataset"
#| include: true

library(ggiraph)
library(scales)

df <- base_pa %>%
  group_by(year) %>%
  summarise(proporcion = mean(proporcion, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    tooltip_txt = paste0(
      "A√±o: ", year,
      "<br>Proporci√≥n: ", percent(proporcion, accuracy = 0.1)
    )
  )

p2 <- ggplot(df, aes(x = year, y = proporcion)) +
  geom_line() +
  ggiraph::geom_point_interactive(
    aes(
      tooltip = tooltip_txt,   # lo que se ve al pasar el mouse
      data_id = year           # id para hover/selecci√≥n
    ),
    size = 2
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de 18 pa√≠ses de Am√©rica Latina",
    subtitle = "1966‚Äì2023",
    x = "A√±o", y = "Porcentaje de ministras"
  ) +
  theme_minimal()

p2 + theme(text = element_text(family = "Inter"))

g <- girafe(ggobj = p2, width_svg = 9, height_svg = 4)

girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)

```

## Porcentaje de ministras en Am√©rica Latina. 1980-2023

```{r}
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboraci√≥n propia con datos de whogov-dataset" 
#| include: true
#| fig-width: 14
#| fig-height: 8
#| fig-dpi: 300

library(dplyr)
library(ggplot2)
library(ggiraph)
library(scales)

df <- base_pa %>%
  filter(year > 1980) %>%
  group_by(year, country_name) %>%
  summarise(proporcion = mean(proporcion, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    tooltip_txt = paste0(
      "<b>", country_name, "</b>",
      "<br>A√±o: ", year,
      "<br>Ministras: ", percent(proporcion, accuracy = 0.1)
    ),
    id = paste(country_name, year, sep = "_")
  )

p <- ggplot(df, aes(x = year, y = proporcion, group = country_name)) +
  geom_line(color = "steelblue", linewidth = 0.8) +
  ggiraph::geom_point_interactive(
    aes(tooltip = tooltip_txt, data_id = id),
    size = 1.8
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de 18 pa√≠ses de Am√©rica Latina",
    subtitle = "1980‚Äì2023",
    x = "A√±o", y = "Porcentaje de ministras"
  ) +
  facet_wrap(~country_name) +
  theme_minimal()

g <- girafe(ggobj = p, width_svg = 10, height_svg = 7)

girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)

```

```{r}
#| title: Representaci√≥n de las mujeres en los gabinetes por d√©cada. 1966 - 2023
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboraci√≥n propia con datos de whogov-dataset"
#| include: true

library(dplyr)
library(ggplot2)
library(scales)

p1<- base_pa %>%
  filter(year > 1980) %>%
  mutate(decada = paste0(floor(year / 10) * 10, "s")) %>%
  ggplot(aes(x = decada, y = proporcion, fill = decada)) +   # ‚úÖ CAMBIO 1
  geom_boxplot(alpha = 0.8) + 
  stat_summary(
    fun = mean,
    geom = "text",
    aes(label = percent(after_stat(y), accuracy = 1)),
    vjust = -0.6,
    fontface = "bold",
    color = "black"
  ) +
  labs(title = "Am√©rica Latina",
    x = "D√©cada",
    y = "Porcentaje de ministras"
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  guides(fill = guide_none(),
         color = guide_none()) +
 scale_colour_paletteer_d("wesanderson::AsteroidCity3")+
scale_fill_paletteer_d("wesanderson::AsteroidCity3")+
    theme_classic()

```

```{r}
#| echo: false
#| warning: false
#| include: true

library(patchwork)
library(ggtext)

patchwork <- p1 / p2

patchwork +
  plot_annotation(
    title = paste0(
      "<span style='font-size:18pt; font-weight:700;'>",
      "Evoluci√≥n en el tiempo de la representaci√≥n de las mujeres",
      "</span><br>",
      "<span style='font-size:18pt; font-weight:700;'>",
      "en los gabinetes de Am√©rica Latina",
      "</span>"
    ),
    theme = theme_minimal(base_size = 11) +
      theme(
        plot.title = ggtext::element_markdown(
          margin = margin(b = 6),
          lineheight = 1.1
        ),
        plot.subtitle = ggtext::element_markdown(
          margin = margin(b = 10),
          lineheight = 1.1
        ),
        plot.caption = ggtext::element_markdown(
          margin = margin(t = 10)
        )
      )
  )

```

```{r}
#| echo: false
#| warning: false
#| include: true

base_paMundo <-WhoGovData  %>%
  mutate(year = as.integer(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_))

Prop_mujeresMundo <- WhoGovData %>%
  mutate(
    year = as.integer(year),
    year_country = paste(year, country_name)  # o unite("year_country", year, country_name, sep = " ", remove = FALSE)
  ) %>%
  group_by(year_country, year, country_name) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_),
    porcentaje = 100 * proporcion
  )%>%
  arrange(country_name)


dfmundo <- base_paMundo %>%
  group_by(year) %>%
  summarise(proporcion = mean(proporcion, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    tooltip_txt = paste0(
      "A√±o: ", year,
      "<br>Proporci√≥n: ", percent(proporcion, accuracy = 0.1)
    )
  )

## Plot Boxplot d√©cadas en todo el mundo 
p3<- base_paMundo %>%
  filter(year > 1980) %>%
  mutate(decada = paste0(floor(year / 10) * 10, "s")) %>%
  ggplot(aes(x = decada, y = proporcion, fill = decada)) +   # ‚úÖ CAMBIO 1
  geom_boxplot(alpha = 0.8) + 
  stat_summary(
    fun = mean,
    geom = "text",
    aes(label = percent(after_stat(y), accuracy = 1)),
    vjust = -0.6,
    fontface = "bold",
    color = "black"
  ) +
  labs(title = "Todo el mundo",
    x = "D√©cada",
    y = "Porcentaje promedio de mujeres en los gabinetes"
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  guides(fill = guide_none(),
         color = guide_none()) +
 scale_colour_paletteer_d("wesanderson::AsteroidCity3")+
scale_fill_paletteer_d("wesanderson::AsteroidCity3")+
    theme_classic()
```

```{r}
#| echo: false
#| warning: false
#| include: true

library(patchwork)
patchwork<- p3+p1
patchwork + plot_annotation(
  title = 'Comparaci√≥n evoluci√≥n en el tiempo de la representaci√≥n de las mujeres en los gabinetes del mundo y de Am√©rica Latina')

```

## Comparaci√≥n base de WhoGov y base de datos de elaboraci√≥n propia

```{r}
#| echo: false
#| warning: false
#| include: true

library(dplyr)
library(scales)
library(ggplot2)
library(ggiraph)
library(readxl)

# Cargar datos desde Excel
base_min <- read_excel("Base_Ministres AL.xlsx")

# Agrupar por a√±o y calcular proporci√≥n promedio
df <- base_min %>%
  group_by(anio) %>%
  summarise(
    proporcion = mean(muj_gab, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    tooltip_txt = paste0(
      "A√±o: ", anio,
      "<br>P: ", percent(proporcion, accuracy = 0.1)
    )
  )

# Crear gr√°fico interactivo
p2 <- ggplot(df, aes(x = anio, y = proporcion)) +
  geom_line() +
  ggiraph::geom_point_interactive(
    aes(
      tooltip = tooltip_txt,
      data_id = anio
    ),
    size = 2
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de 18 pa√≠ses de Am√©rica Latina",
    subtitle = "2000‚Äì2025",
    x = "A√±o", y = "Porcentaje de ministras"
  ) +
  theme_minimal()

p2 <- p2 + theme(text = element_text(family = "Inter"))

# Crear objeto interactivo
g <- girafe(ggobj = p2, width_svg = 9, height_svg = 4)

# Opciones interactivas
girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)

```



```{r}
#| echo: false
#| warning: false
#| include: true

library(readxl)
library(dplyr)
library(ggplot2)
library(scales)

# Leer base
base_min <- read_excel("Base_Ministres AL.xlsx")

p1 <- base_min %>%
  mutate(decada = paste0(floor(anio / 10) * 10, "s")) %>%
  ggplot(aes(x = decada, y = muj_gab, fill = decada)) +
  
  geom_boxplot(alpha = 0.8) +
  
  stat_summary(
    fun = mean,
    geom = "text",
    aes(
      y = muj_gab,
      label = scales::percent(after_stat(y), accuracy = 1)
    ),
    vjust = -0.6,
    fontface = "bold",
    color = "black"
  ) +
  
  labs(
    title = "Am√©rica Latina",
    x = "D√©cada",
    y = "Porcentaje de ministras"
  ) +
  
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  theme_classic() +
  theme(legend.position = "none")

print(p1)



```

```{r}
#| echo: false
#| warning: false
#| include: true

library(dplyr)
library(scales)
library(ggplot2)
library(ggiraph)
library(readxl)

# Leer los datos
base_min <- read_excel("Base_Ministres AL.xlsx")

# Agrupar por pa√≠s y a√±o, y calcular proporci√≥n promedio
df <- base_min %>%
  group_by(pais, anio) %>%
  summarise(
    proporcion = mean(muj_gab, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    tooltip_txt = paste0(
      "Pa√≠s: ", pais,
      "<br>A√±o: ", anio,
      "<br>Proporci√≥n: ", percent(proporcion, accuracy = 0.1)
    )
  )

# Crear gr√°fico interactivo con facet_wrap por pa√≠s
p2 <- ggplot(df, aes(x = anio, y = proporcion)) +
  geom_line() +
  ggiraph::geom_point_interactive(
    aes(
      tooltip = tooltip_txt,
      data_id = paste(pais, anio, sep = "_")
    ),
    size = 2
  ) +
  facet_wrap(~ pais) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de Am√©rica Latina",
    subtitle = "2000‚Äì2025",
    x = "A√±o", y = "Porcentaje de ministras"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Inter"),
    strip.text = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Crear objeto interactivo
g <- girafe(ggobj = p2, width_svg = 10, height_svg = 7)

# Configurar interactividad
girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)

```
```{r}
#| echo: false
#| warning: false
#| include: true

library(dplyr)
library(scales)
library(ggplot2)
library(ggiraph)
library(readxl)

# Leer los datos
base_min <- read_excel("Base_Ministres AL.xlsx")

# Agrupar por pa√≠s y a√±o
df <- base_min %>%
  group_by(pais, anio) %>%
  summarise(
    proporcion = mean(muj_gab, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    tooltip_txt = paste0(
      "Pa√≠s: ", pais,
      "<br>A√±o: ", anio,
      "<br>Proporci√≥n: ", percent(proporcion, accuracy = 0.1)
    )
  )

# Crear gr√°fico interactivo con l√≠nea en 40%
p2 <- ggplot(df, aes(x = anio, y = proporcion)) +
  geom_line() +
  ggiraph::geom_point_interactive(
    aes(
      tooltip = tooltip_txt,
      data_id = paste(pais, anio, sep = "_")
    ),
    size = 2
  ) +
  geom_hline(yintercept = 0.45, linetype = "dashed", color = "red", linewidth = 0.5) +  # üî¥ L√≠nea del 40%
  facet_wrap(~ pais) +
  scale_y_continuous(labels = percent_format(accuracy = 1), limits = c(0, 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de Am√©rica Latina",
    subtitle = "2000‚Äì2025. L√≠nea roja indica el umbral del 40%",
    x = "A√±o", y = "Porcentaje de ministras"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family = "Inter"),
    strip.text = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Crear objeto interactivo
g <- girafe(ggobj = p2, width_svg = 10, height_svg = 7)

# Opciones interactivas
girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)



```

