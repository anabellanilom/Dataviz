---
title: "dataviz"
format: html
editor: visual
---

## Exploración de datos con R. 

En esta sección muestro algunos gráficos realizados para explorar datos.En esta ocasión provenientes de:

-   Nuffield Politics Research Centre. (s. f.). WhoGov dataset. Nuffield College, University of Oxford. Recuperado el 3 de enero de 2026, de <https://politicscentre.nuffield.ox.ac.uk/whogov-dataset/>

## Representación de las mujeres en los gabinetes del mundo.

```{r}
#| echo: false
#| warning: false
#| include: false
## Chunk 1
library (tidyverse)
library(readr)
library (dplyr)
library(tidyr)
library(stringr)
library(gt)
library(ggplot2)
library(paletteer)
library(gander)
library(ellmer)
library(usethis)

## Leer base whogov

WhoGovData <- read_csv("Data/WhoGov_crosssectional_V3.1.csv")

#Cantidad de países en la base (datos sobre mi unidad de análisis)

Cantidaddepaises <- WhoGovData %>%
  count(country_name, sort = TRUE) %>%
  mutate(n)
Cantidaddepaises

#Selección sólo de América Latina 

codigos <- c("ARG","BOL","BRA","CHL","COL","CRI","DOM","ECU","SLV","GTM","HND","MEX","NIC","PAN","PRY","PER","URY","VEN")

WhoGovData <- WhoGovData %>%
  mutate(country_isocode = str_to_upper(str_trim(country_isocode)))

AmericaLatina <- WhoGovData %>%
  filter(country_isocode %in% codigos)

# ¿Cuántos países quedaron?
AmericaLatina %>% count(country_isocode, sort = TRUE)

# Diagnóstico: ¿algún código pedido no aparece en la base?
setdiff(codigos, unique(WhoGovData$country_isocode))

```

```{r}
#| echo: true
#| warning: false
#| include: false

## Chunck 2
#Proporción de mujeres
Prop_mujeres <- AmericaLatina %>%
  mutate(
    year = as.integer(year),
    year_country = paste(year, country_name)  # o unite("year_country", year, country_name, sep = " ", remove = FALSE)
  ) %>%
  group_by(year_country, year, country_name) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_),
    porcentaje = 100 * proporcion
  )%>%
  arrange(country_name)

resumen_mujeres <- AmericaLatina %>%
  summarise(
    media_fem      = mean(n_female_total, na.rm = TRUE),
    mediana_fem    = median(n_female_total, na.rm = TRUE),
    desvio_std_fem = sd(n_female_total, na.rm = TRUE),
    min_fem        = min(n_female_total, na.rm = TRUE),
    max_fem        = max(n_female_total, na.rm = TRUE),
    rango_fem      = diff(range(n_female_total, na.rm = TRUE)), # max - min robusto
    iqr_fem        = IQR(n_female_total, na.rm = TRUE),
    cantidad_obs   = n()
  )

base_pa <- AmericaLatina %>%
  mutate(year = as.integer(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    n_female_total = sum(n_female_total, na.rm = TRUE),
    n_total        = sum(n_total,        na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(proporcion = if_else(n_total > 0, n_female_total / n_total, NA_real_))

```

```{r}
#| title: Estadísticas descriptivas de ministras en el período 1966 a 2023
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboración propia con datos de whogov - dataset"
#| include: true
#| fig-width: 14
#| fig-height: 8
#| fig-dpi: 300

##Chunk 3

resumen_global <- base_pa %>%
summarise(
ministras_total = sum(n_female_total, na.rm = TRUE),
cargos_totales  = sum(n_total, na.rm = TRUE),
prop_ministras  = if_else(cargos_totales > 0, ministras_total / cargos_totales, NA_real_),
prom_pa         = mean(proporcion, na.rm = TRUE),  
mediana_pa      = median(proporcion, na.rm = TRUE),
iqr_pa          = IQR(proporcion, na.rm = TRUE),
n_pais_anio     = n()
)

resumen_global %>%
gt() %>%
cols_label(
ministras_total = "Total Ministras",
cargos_totales  = "Cargos totales (suma)",
prop_ministras  = "Proporción de ministras en todo el período",
prom_pa         = "Promedio país-año",
mediana_pa      = "Mediana país-año",
iqr_pa          = "IQR país-año",
n_pais_anio     = "N país-año"
) %>%
fmt_number(columns = c(ministras_total, cargos_totales, n_pais_anio), decimals = 0) %>%
fmt_percent(columns = c(prop_ministras, prom_pa, mediana_pa, iqr_pa), decimals = 1) %>%
tab_header(title = md("**Estadísticas descriptivas de representación de ministras en el período 1966 a 2023**"), subtitle = " Región completa en todo el período")
```

```{r}
#| echo: false
#| warning: false
#| include: false

##Chunck 4
# 1) Resumen por año
resumen_anual <- base_pa %>%
  group_by(year) %>%
  summarise(
    ministras_total = sum(n_female_total, na.rm = TRUE),
    cargos_totales  = sum(n_total, na.rm = TRUE),
    prop_ministras  = if_else(cargos_totales > 0, ministras_total / cargos_totales, NA_real_),
    prom_pa         = mean(proporcion, na.rm = TRUE),   # promedio de proporción país-año
    mediana_pa      = median(proporcion, na.rm = TRUE), # mediana de proporción país-año
    iqr_pa          = IQR(proporcion, na.rm = TRUE),    # rango intercuartílico
    n_pais_anio     = n()
  ) %>%
  arrange(year)

# 2) Tabla con gt
resumen_anual %>%
  gt() %>%
  cols_label(
    year            = "Año",
    ministras_total = "Total ministras",
    cargos_totales  = "Cargos totales (año)",
    prop_ministras  = "Proporción regional",
    prom_pa         = "Promedio país-año",
    mediana_pa      = "Mediana país-año",
    iqr_pa          = "IQR país-año",
    n_pais_anio     = "N país-año"
  ) %>%
  fmt_number(columns = c(ministras_total, cargos_totales, n_pais_anio), decimals = 0) %>%
  fmt_percent(columns = c(prop_ministras, prom_pa, mediana_pa, iqr_pa), decimals = 1) %>%
  tab_header(
    title = md("**Resumen global de representación de ministras en el período 1966 a 2023 por año**"),
    subtitle = "Región completa (1966–2023)"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboración propia con datos de whogov-dataset"
#| include: true

## Chunk 5

library(ggiraph)
library(scales)

df <- base_pa %>%
  group_by(year) %>%
  summarise(proporcion = mean(proporcion, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    tooltip_txt = paste0(
      "Año: ", year,
      "<br>Proporción: ", percent(proporcion, accuracy = 0.1)
    )
  )

p <- ggplot(df, aes(x = year, y = proporcion)) +
  geom_line() +
  ggiraph::geom_point_interactive(
    aes(
      tooltip = tooltip_txt,   # lo que se ve al pasar el mouse
      data_id = year           # id para hover/selección
    ),
    size = 2
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de 18 países de América Latina",
    subtitle = "1966–2023",
    x = "Año", y = "Proporción"
  ) +
  theme_minimal()

g <- girafe(ggobj = p, width_svg = 9, height_svg = 4)

girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)








```

## Porcentaje de ministras en América Latina. 1980-2023

```{r}
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboración propia con datos de whogov-dataset" 
#| include: true
#| fig-width: 14
#| fig-height: 8
#| fig-dpi: 300

##Chunk 7

library(dplyr)
library(ggplot2)
library(ggiraph)
library(scales)

df <- base_pa %>%
  filter(year > 1980) %>%
  group_by(year, country_name) %>%
  summarise(proporcion = mean(proporcion, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    tooltip_txt = paste0(
      "<b>", country_name, "</b>",
      "<br>Año: ", year,
      "<br>Ministras: ", percent(proporcion, accuracy = 0.1)
    ),
    id = paste(country_name, year, sep = "_")
  )

p <- ggplot(df, aes(x = year, y = proporcion, group = country_name)) +
  geom_line(color = "steelblue", linewidth = 0.8) +
  ggiraph::geom_point_interactive(
    aes(tooltip = tooltip_txt, data_id = id),
    size = 1.8
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Porcentaje de ministras en los gabinetes de 18 países de América Latina",
    subtitle = "1980–2023",
    x = "Año", y = "Porcentaje de ministras"
  ) +
  facet_wrap(~country_name) +
  theme_minimal()

g <- girafe(ggobj = p, width_svg = 10, height_svg = 7)

girafe_options(
  g,
  opts_hover(css = "fill-opacity:1; r:4;"),
  opts_tooltip(css = "background-color:white; padding:6px; border-radius:6px;"),
  opts_zoom(min = 1, max = 5)
)

```

```{r}
#| title: Representación de las mujeres en los gabinetes por década. 1966 - 2023
#| echo: false
#| warning: false
#| fig-cap: "Fuente: Elaboración propia con datos de whogov-dataset"
#| include: true


library(dplyr)
library(ggplot2)
library(scales)

base_pa %>%
  filter(year > 1980) %>%
  mutate(decada = paste0(floor(year / 10) * 10, "s")) %>%
  ggplot(aes(x = decada, y = proporcion, fill = decada)) +   # ✅ CAMBIO 1
  geom_boxplot(alpha = 0.8) + 
  stat_summary(
    fun = mean,
    geom = "text",
    aes(label = percent(after_stat(y), accuracy = 1)),
    vjust = -0.6,
    fontface = "bold",
    color = "black"
  ) +
  labs(
    title = "Distribución de la proporción de mujeres por década",
    x = "Década",
    y = "Proporción de mujeres"
  ) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  guides(fill = guide_none(),
         color = guide_none()) +
 scale_colour_paletteer_d("wesanderson::AsteroidCity3")+
scale_fill_paletteer_d("wesanderson::AsteroidCity3")+
    theme_classic()


```